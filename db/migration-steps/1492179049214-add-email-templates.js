var _ = require('lodash');

var templates = [
  {'key':'record.updated','trigger':'Record Updated','recipients':['participants','owner', 'assignee'],'subject':'Record {{record.recordId}} has been updated','body':'<p><br>id: {{record.recordId}}</p><p>title: {{record.title}}</p><p>status: {{record.status}}</p><p>findings: {{record.findings}}</p><p>createdDate: {{record.createdDate}}</p><p>updatedAt: {{record.updatedAt}}</p><p><br></p><p>owner id: {{record.owner.orgUnitId}}</p><p>owner code: {{record.owner.orgCode}}</p><p>owner name: {{record.owner.orgName}}</p><p><br></p><p>overallAssessment:</p><p>initialRating: {{record.overallAssessment.initialRating}}</p><p>initialCost: {{record.overallAssessment.initialCost}}</p><p>targetRating: {{record.overallAssessment.targetRating}}</p><p>targetCost: {{record.overallAssessment.targetCost}}</p><p><br></p><p>URL: {{record.URL}}</p><p><br></p><p>recipient:<br>userId: {{recipient.userId}}</p><p>givenName: {{recipient.givenName}}</p><p>familyName: {{recipient.familyName}}</p><p>email: {{recipient.email}}</p><p>role: {{recipient.role}}</p><p><br></p>'},
  {'key':'record.identified','trigger':'Record Identified','recipients':['participant', 'owners'],'subject':'Record identified {{governanceRecord.recordId}}','body':'<p><br>id: {{record.recordId}}</p><p>title: {{record.title}}</p><p>status: {{record.status}}</p><p>findings: {{record.findings}}</p><p>createdDate: {{record.createdDate}}</p><p>updatedAt: {{record.updatedAt}}</p><p><br></p><p>owner id: {{record.owner.orgUnitId}}</p><p>owner code: {{record.owner.orgCode}}</p><p>owner name: {{record.owner.orgName}}</p><p><br></p><p>overallAssessment:</p><p>initialRating: {{record.overallAssessment.initialRating}}</p><p>initialCost: {{record.overallAssessment.initialCost}}</p><p>targetRating: {{record.overallAssessment.targetRating}}</p><p>targetCost: {{record.overallAssessment.targetCost}}</p><p><br></p><p>URL: {{record.URL}}</p><p><br></p><p>recipient:<br>userId: {{recipient.userId}}</p><p>givenName: {{recipient.givenName}}</p><p>familyName: {{recipient.familyName}}</p><p>email: {{recipient.email}}</p><p>role: {{recipient.role}}</p><p><br></p>'},
  {'key':'control.new','trigger':'Control Created','recipients':['owner', 'assignee'],'subject':'New Control {{control.controlId}} has been created','body':'<p>controlId: {{control.controlId}}</p><p>title: {{control.title}}</p><p>status: {{control.status}}</p><p>description: {{{control.description}}}</p><p>URL: {{control.URL}}</p><p><br></p><p>responsibleOrg:</p><p>orgUnitId: {{control.responsibleOrg.orgUnitId}}</p><p>orgCode: {{control.responsibleOrg.orgCode}}</p><p>orgName: {{control.responsibleOrg.orgName}}</p><p><br></p><p>responsibleUser:</p><p>userId: {{control.responsibleUser.userId}}</p><p>givenName: {{control.responsibleUser.givenName}}</p><p>familyName: {{control.responsibleUser.familyName}}</p><p>email: {{control.responsibleUser.email}}</p><p>role: {{control.responsibleUser.role}}</p><br>'},
  {'key':'control.updated','trigger':'Control Updated','recipients':['owner', 'assignee'],'subject':'Control {{control.controlId}} has been updated','body':'<p><br>controlId: {{control.controlId}}</p><p>title: {{control.title}}</p><p>status: {{control.status}}</p><p>description: {{{control.description}}}</p><p>URL: {{control.URL}}</p><p><br></p><p>responsibleOrg:</p><p>orgUnitId: {{control.responsibleOrg.orgUnitId}}</p><p>orgCode: {{control.responsibleOrg.orgCode}}</p><p>orgName: {{control.responsibleOrg.orgName}}</p><p><br></p><p>responsibleUser:</p><p>userId: {{control.responsibleUser.userId}}</p><p>givenName: {{control.responsibleUser.givenName}}</p><p>familyName: {{control.responsibleUser.familyName}}</p><p>email: {{control.responsibleUser.email}}</p><p>role: {{control.responsibleUser.role}}</p><br>'},
  {'key':'review.scheduled','trigger':'Review Scheduled','recipients':['participants', 'owners'],'subject':'New Review {{review.reviewId}} Scheduled','body':'<p><br>reviewId: {{review.reviewId}}</p><p>title: {{review.title}}</p><p>scheduleType: {{review.scheduleType}}</p><p>reviewType: {{review.reviewType}}</p><p>status: {{review.status}}</p><p>bodyText: {{{review.bodyText}}}</p><p>createdDate: {{review.createdDate}}</p><p>updatedA:t {{review.updatedAt}}</p><p>URL: {{review.URL}}</p><p><br></p><p>scheduledBy:</p><p>userId: {{review.scheduledBy.userId}}</p><p>givenName: {{review.scheduledBy.givenName}}</p><p>familyName :{{review.scheduledBy.familyName}}</p><p>email: {{review.scheduledBy.email}}</p><p>role: {{review.scheduledBy.role}}</p><p></p><br>'},
  {'key':'review.updated','trigger':'Review Updated','recipients':['participants', 'owner', 'assignee'],'subject':'Review {{review.reviewId}} has been Updated','body':'<p>reviewId: {{review.reviewId}}</p><p>title: {{review.title}}</p><p>scheduleType: {{review.scheduleType}}</p><p>reviewType: {{review.reviewType}}</p><p>status: {{review.status}}</p><p>bodyText: {{{review.bodyText}}}</p><p>createdDate: {{review.createdDate}}</p><p>updatedA:t {{review.updatedAt}}</p><p>URL: {{review.URL}}</p><p><br></p><p>scheduledBy:</p><p>userId: {{review.scheduledBy.userId}}</p><p>givenName: {{review.scheduledBy.givenName}}</p><p>familyName :{{review.scheduledBy.familyName}}</p><p>email: {{review.scheduledBy.email}}</p><p>role: {{review.scheduledBy.role}}</p><br>'},
  {'key':'actionItem.new','trigger':'Action Item Created','recipients':['owner', 'assignee'],'subject':'New action item {{actionItem.Id}} created - {{actionItem.title}}','body':'<p>Hi,</p><p>A new action item {{actionItem.actionId}}&nbsp;has been created </p><p>Title:&nbsp;{{actionItem.title}}</p><p>Created By:&nbsp;{{createdBy.givenName}}&nbsp;{{createdBy.familyName}}</p><p>Assigned To:&nbsp;{{assignedTo.givenName}}&nbsp;{{assignedTo.familyName}}</p><p><span style=\'line-height: 18.5714302062988px;\'>Status :&nbsp;</span>{{actionItem.status}}<span style=\'line-height: 18.5714302062988px;\'></span></p><p><span style=\'line-height: 18.5714302062988px;\'>Priority :&nbsp;</span>{{actionItem.priority}}<span style=\'line-height: 18.5714302062988px;\'></span></p><p><span style=\'line-height: 18.5714302062988px;\'>Findings :&nbsp;</span>{{actionItem.findings}}<span style=\'line-height: 18.5714302062988px;\'></span></p><p><span style=\'line-height: 18.5714302062988px;\'>Required Action :&nbsp;</span>{{actionItem.actionRequired}}<span style=\'line-height: 18.5714302062988px;\'></span></p><p><span style=\'line-height: 18.5714302062988px;\'></span><span style=\'line-height: 18.5714302062988px;\'><br></span></p><p><span style=\'line-height: 18.5714302062988px;\'>Kind Regards,</span></p><p><span style=\'line-height: 18.5714302062988px;\'>Team Riski</span></p>'},
  {'key':'actionItem.updated','trigger':'Action Item Updated','recipients':['owner', 'assignee'],'subject':'Action item {{actionItem.actionId}} has been updated - {{actionItem.title}}','body':'<p></p><p>Hi,</p><p>Action item {{actionItem.actionId}}&nbsp;has been updated </p><p>Title:&nbsp;{{actionItem.title}}</p><p>Created By:&nbsp;{{actionItem.createdBy.givenName}}&nbsp;{{actionItem.createdBy.familyName}}</p><p>Assigned To:&nbsp;{{actionItem.assignedTo.givenName}}&nbsp;{{actionItem.assignedTo.familyName}}</p><p><span style=\'line-height: 18.5714302062988px;\'>Status :&nbsp;</span>{{actionItem.status}}<span style=\'line-height: 18.5714302062988px;\'></span></p><p><span style=\'line-height: 18.5714302062988px;\'>Priority :&nbsp;</span>{{actionItem.priority}}<span style=\'line-height: 18.5714302062988px;\'></span></p><p><span style=\'line-height: 18.5714302062988px;\'>Findings :&nbsp;</span>{{actionItem.findings}}<span style=\'line-height: 18.5714302062988px;\'></span></p><p><span style=\'line-height: 18.5714302062988px;\'>Required Action :&nbsp;</span>{{actionItem.actionRequired}}<span style=\'line-height: 18.5714302062988px;\'></span></p><p><span style=\'line-height: 18.5714302062988px;\'></span><span style=\'line-height: 18.5714302062988px;\'>URL: </span>{{actionItem.URL}}</a></p><p><span style=\'line-height: 18.5714302062988px;\'><br></span></p><p><span style=\'line-height: 18.5714302062988px;\'>createdByRole: </span>{{actionItem.createdBy.role}}<span style=\'line-height: 18.5714302062988px;\'><br></span></p><p><span style=\'line-height: 18.5714302062988px;\'>Kind Regards,</span></p><p><span style=\'line-height: 18.5714302062988px;\'>Team Riski</span></p><p></p>'},
  {'key':'user.deregistration','trigger':'User Deregistration','recipients':['user','account_admin']},
  {'key':'user.registration','trigger':'User Registration','recipients':['user','inviter']},
  {'key':'member.rolechange','trigger':'Member Role Changed','recipients':['user', 'manager']},
  {'key':'member.confirmation','trigger':'Member Confirmation','recipients':['user','inviter']},
  {'key':'comment.new','trigger':'New Comment','recipients':['user', 'owner', 'participants']},
  {'key':'membership.request','trigger':'Membership Requested','recipients':['assignee']},
];

module.exports = {
    id: '1492179049214-add-email-templates',

    up : function(db, cb){
        db.collection('emailtemplates').insertMany(templates, cb);
    },

    down : function(db, cb){
        var keys = _.map(templates, 'key');
        db.collection('emailtemplates').deleteMany({key : {$in : keys}}, cb);
    }
}